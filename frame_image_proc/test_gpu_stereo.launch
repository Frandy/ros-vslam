<?xml version="1.0"?>
<!-- vim: set fenc=utf-8 et sts=4 ft=xml : -->
<launch>

    <!-- IEEE1394 camera driver -->
    <!-- Nodelet Host process -->
    <node
        pkg="nodelet"
        type="nodelet"
        name="camera_process"
        args="manager"
        output="log"
        >
    </node>
    <node
         pkg="nodelet"
         type="nodelet"
         name="left"
         args="load camera1394/driver /camera_process"
         ns="/stereo"
         output="log"
         >

        <param name="guid" type="string" value="00b09d0100a8563d"/>
        <param name="video_mode" value="640x480_mono8"/>
        <param name="frame_id" value="navigation_stereo"/>
        <param name="frame_rate" value="15"/>
        <param name="bayer_pattern" value="rggb"/>
        <param name="camera_info_url"
               type="string"
               value="file://$(find samplereturn)/calibration/ffmv-left.yaml" />
        <remap from="camera" to="left" />
    </node>
    <node
         pkg="nodelet"
         type="nodelet"
         name="right"
         args="load camera1394/driver /camera_process"
         ns="/stereo"
         output="log"
         >

        <param name="guid" type="string" value="00b09d0100a8566e"/>
        <param name="video_mode" value="640x480_mono8"/>
        <param name="frame_id" value="navigation_stereo"/>
        <param name="frame_rate" value="15"/>
        <param name="bayer_pattern" value="rggb"/>
        <param name="camera_info_url"
               type="string"
               value="file://$(find samplereturn)/calibration/ffmv-right.yaml" />
        <remap from="camera" to="right" />
    </node>

    <!-- Debayer -->
    <node pkg="nodelet"
          type="nodelet"
          name="debayer_left"
          args="load image_proc/debayer /camera_process"
          ns="/stereo/left"
          output="log"
          >
    </node>
    <node pkg="nodelet"
          type="nodelet"
          name="debayer_right"
          args="load image_proc/debayer /camera_process"
          ns="/stereo/right"
          output="log"
          >
    </node>

    <!-- Rectify images -->
    <node
        pkg="nodelet"
        type="nodelet"
        name="rect_left"
        args="load image_proc/rectify /camera_process"
        ns="/stereo/left"
        output="log"
        >
        <remap from="image" to="image_mono"/>
    </node>
    <node
        pkg="nodelet"
        type="nodelet"
        name="rect_right"
        args="load image_proc/rectify /camera_process"
        ns="/stereo/right"
        output="log"
        >
        <remap from="image" to="image_mono"/>
    </node>

    <!-- Display rectified images -->
    <!--
    <node
        pkg="image_view"
        type="image_view"
        name="left_rect_display"
        ns="/stereo/left/"
        output="log"
        >

        <remap from="image" to="image_rect"/>
    </node>
    <node
        pkg="image_view"
        type="image_view"
        name="right_rect_display"
        ns="/stereo/right/"
        output="log"
        >

        <remap from="image" to="image_rect"/>
    </node>
    -->

    <!-- Compute Stereo -->
    <node
        pkg="nodelet"
        type="nodelet"
        name="stereo_image_disparity"
        args="load frame_image_proc/disparity /camera_process"
        ns="/stereo"
        output="log"
        >
        <param name="correlation_window_size" type="int" value="17"/>
        <param name="min_disparity" type="int" value="0"/>
        <param name="disparity_range" type="int" value="256"/>
        <param name="uniqueness_ratio" type="int" value="5"/>
        <param name="texture_threshold" type="int" value="1000"/>
        <param name="approximate_sync" type="bool" value="true"/>
        <param name="use_gpu" type="bool" value="false"/>
    </node>

    <!-- Display Disparity -->
    <!--
    <node
        pkg="nodelet"
        type="nodelet"
        name="vis_disparity"
        args="load image_view/disparity /camera_process"
        ns="/stereo"
        output="log"
        >

        <remap from="image" to="disparity"/>
    </node>
    <node
        pkg="image_view"
        type="disparity_view"
        name="vis_disparity"
        ns="/stereo"
        output="log"
        >

        <remap from="image" to="disparity"/>
    </node>
    -->
 
</launch>
